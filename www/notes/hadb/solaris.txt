Initial Prep Instructions for Solaris10

	Note:  I don't know much about administering solaris,
	especially solaris 10!  Much of these was learned by trial and
	error.  If you know the "right" way to do this, please update
	the instructions (and this caveat).  -DJE

Based on "HADB Config-Setup Guide and Use Cases for HADB Odin 2/3"
which is not the version we're running, but is the most recent doc.

NOTE that these probably will NOT work in a Solaris Zone, because
their config is done differently.  It might be necessary to do all of
this on the underlying "real" host.

0.  For general-purpose stuff:  make sure that home directories are
    mounted.  If they're not, you'll need to appeal to a higher
    authority (someone who knows something about managing an S10 box)
    because I couldn't figure out how to do this.

1.  Make sure that xntp is properly configured and running.  The
    clocks for all of the HADB servers (and clients, perhaps) must be
    in good sync.

	NOTE:  it is reportedly better to have one of the nodes be an
	    NTP master and have the others be its slave.  In fact,
	    this is how the ETC machines are configured now
	    (darkstar10 is the master) but I don't now how to do this.

    a) Set up /etc/inet/ntp.conf.  Copy from /etc/inet/ntp.client, and
	add appropriate server lines.

	For the ETC:

	    multicastclient 224.0.1.1
	    server complab1
	    server 10.8.2.10

	For general machines:

	    server ai-ubur02-01
	    server nautntp
	    server espburntp

    b) Get things started by starting the clocks in sync.
    
	For the ETC:  execute 'rdate complab1'

	Note that complab1 doesn't seem to be a very accurate time
	server, but it's the one we are supposed to use.

    c) Add the service, by executing:

	svcadm enable svc:/network/ntp:default
	/lib/svc/method/xntp start

    d) reboot (or defer until other steps are done)

2.  Make sure that sshd is running.

    a) Edit /etc/ssh/sshd_config and other files

    b) Create keys, if necessary:

	ssh-keygen -t dsa -f ssh_host_dsa_key
	ssh-keygen -t rsa -f ssh_host_rsa_key

    c) Enable the service and start it:

	svcadm enable svc:/network/ssh:default
	/lib/svc/method/sshd start

3.  Set up semaphores and shared memory system params.  The numbers
    here are for a system with 20 nodes and approx 80 connections. 
    How the numbers are calculated is described below.
    
    [These should be double-checked with the HADB folk.  They seem to
    change from one release to the next.  -DJE]

    a) Concatenate this to /etc/system:

	    # HADB parameters
	    set semsys:seminfo_semmap=30
	    set semsys:seminfo_semmni=30
	    set semsys:seminfo_semmns=180
	    set semsys:seminfo_semmnu=1000

	    set shmsys:shminfo_shmmax=0x20000000
	    set shmsys:shminfo_shmseg=20
	    set shmsys:shminfo_semmnu=1000
	    set shmsys:shminfo_semmni=220

	How these are calculated:

		semmap = 10 + NNODES
		semmni = 10 + NNODES
		semmns = 60 + (NNODES * 6)
		semmnu = 1000 (their suggestion)
		shmmax = 512M
		shmseg = NNODES (my ballpark guess)
		shmmni = 100 + (NNODES * 6)

    b) reboot (or defer until other steps are done).  Unlike the
	services, which can be started by hand, these changes will not
	take effect until the next boot.

4. Set up hostnames, netmasks.

    a) add local hostnames to /etc/hosts, /etc/inet/ipnodes.  For each
	individual host, remember to assign the loghost to the local
	IP as well.

	If the hosts have more than one network port, make sure that
	there is a name for each.  For the ETC, we simulate having
	three subnets by using 20.20.10.*, 20.20.11.*, and 20.20.12.*
	for the second network port, which are attached to a switch
	that is not attached to any other network.  The 20.* subnets
	are generally used for local, private subnets (exactly what we
	want for this) but you will need to find the correct address
	blocks from the local sysadmin.

	For ETC:

	    10.8.1.* connects to SWAN.  20.20.* is private.

	    10.8.2.10       complab1

	    10.8.2.151      darkstar1
	    10.8.2.152      darkstar2
	    10.8.2.153      darkstar3
	    10.8.2.154      darkstar4
	    10.8.2.150      darkstar5
	    10.8.2.156      darkstar6
	    10.8.2.157      darkstar7
	    10.8.2.158      darkstar9
	    10.8.2.159      darkstar8
	    10.8.2.160      darkstar10

	    # 20.20.10.* are for the first set of nodes
	    # 20.20.11.* are for their mirrors
	    # 20.20.12.* are for the test clients

	    20.20.10.101    darkstar1-1
	    20.20.10.102    darkstar2-1
	    20.20.10.103    darkstar3-1
	    20.20.10.104    darkstar4-1
	    20.20.11.105    darkstar5-1
	    20.20.11.106    darkstar6-1
	    20.20.11.107    darkstar7-1
	    20.20.11.108    darkstar8-1
	    20.20.12.109    darkstar9-1
	    20.20.12.110    darkstar10-1

    b) edit /etc/inet/netmasks:

	The HADB blades need to be able to broadcast to each other
	(?).  So the netmasks must include all the hosts that need to
	talk to each other, unless there's a router between. 

    	For ETC:

	    # For 10.8.2.*, everyone is on the same subnet.  For
	    # the others, we need to broaden the netmask to permit
	    # messages from one to the other: there's no router here.

	    10.8.2.0	255.255.255.0
	    20.20.10.0	255.255.0.0
	    20.20.11.0	255.255.0.0
	    20.20.12.0	255.255.0.0

    c) enable the bge1 interface (or other ports, if there is more
	than one):

	For V20z blades with bge0 and bge1 interfaces:

	    if (! -f /etc/hostname.bge1) then
		cp /etc/hostname.bge0 /etc/hostname.bge1
	    endif

	    edit /etc/hostname.bge1 so that it has the same hostname
	    with a "-1" suffix (i.e.; "darkstar1" becomes
	    "darkstar1-1").  The name choices are arbitrary but MUST
	    agree with /etc/hosts and /etc/inet/ipnodes, and it's a
	    lot easier to remember if there's an obvious relationship.

	    Apparently must reboot in order for this to take effect. 
	    (There's probably another way, but I don't know it.)

