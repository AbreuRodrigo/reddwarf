<?xml version="1.0" encoding="UTF-8"?>

<project name="redstar" default="build" basedir=".">

  <description>
    This is the Ant file that defines the build process for the Redstar
    revision of Project Darkstar.
  </description>

  <!-- VARIABLE DEFINITIONS -->

  <!-- Common locations -->
  <property name="docDir" location="doc"/>
  <property name="libDir" location="lib"/>
  <property name="srcDir" location="src"/>
  <property name="testDir" location="test"/>

  <!-- Common build locations -->
  <property name="buildBaseDir" location="build"/>
  <property name="buildClassDir" location="${buildBaseDir}/classes"/>
  <property name="buildDocDir" location="${buildBaseDir}/doc"/>
  <property name="buildLibDir" location="${buildBaseDir}/lib"/>

  <!-- Values for controlling compilation -->
  <property name="javac.source" value="1.5" />
  <property name="javac.compilerargs"
	    value="-Xlint:unchecked,deprecation" />

  <!-- Values for the server -->
  <property name="serverClassDir" location="${buildClassDir}/server"/>
  <property name="serverJarFile" location="${buildLibDir}/sgs.jar"/>
  <property name="serverSrcDir" location="${srcDir}/server/j2se"/>

  <!-- Values for the JavaDocs -->
  <property name="baseJavadocDir" location="${buildDocDir}/javadoc"/>
  <property name="serverJavadocDir" location="${baseJavadocDir}/server"/>
  <property name="projName" value="Sun Game Server"/>
  <property name="projVersion" value="0.2"/>
  <property name="jdk.doc.api.url"
	    value="http://java.sun.com/j2se/1.5/docs/api"/>
  <property name="jdk.package.list" value="etc/jdk5.0_package_list"/>

  <!-- TARGET DEFINITIONS -->

  <!-- Builds a debug version of the complete project -->
  <target name="build" depends="build-server"/>

  <!-- Builds the server -->
  <target name="build-server">
    <mkdir dir="${serverClassDir}"/>
    <depend srcdir="j2se"
	    destdir="${serverClassDir}"
	    cache="${buildBaseDir}/depend"
	    closure="true"/>
    <javac includeAntRuntime="no" debug="on" deprecation="on"
           srcdir="${serverSrcDir}" destdir="${serverClassDir}"
           classpath="${serverClassDir}" source="${javac.source}">
      <compilerarg value="${javac.compilerargs}"/>
    </javac>
  </target>

  <!-- Removes all built files and all ~ files -->
  <target name="clean">
    <delete dir="${buildBaseDir}"/>
    <delete>
      <fileset dir="." defaultexcludes="no" includes="**/*~"/>
    </delete>
  </target>

  <!-- Builds the documentation -->
  <target name="doc" depends="javadoc"/>

  <!-- Build the JavaDoc from the source -->
  <target name="javadoc" depends="javadoc-server"/>

  <!-- Build the server JavaDoc -->
  <target name="javadoc-server" depends="build-server">
    <javadoc sourcepath="${serverSrcDir}" destdir="${serverJavadocDir}"
             classpath="${serverClassDir}" packagenames="com.sun.*"
             overview="${serverSrcDir}/overview.html"
             windowtitle="${projName}" doctitle="${projName}" author="no">
      <link href="${jdk.doc.api.url}"
	    offline="true"
	    packagelistLoc="${jdk.package.list}"/>
      <footer>
        <![CDATA[<font size="-1">Project Darkstar: Redstar version
        ${projVersion}</font>]]>
      </footer>
      <bottom>
        <![CDATA[<font size="-1">Copyright 2006 Sun Microsystems,
        Inc. All rights reserved. Use is subject to license
        terms.<p>Sun, Sun Microsystems, the Sun Logo, and Java are
        trademarks or registered trademarks of Sun Microsystems, Inc. in
        the US and other countries.</font>]]>
      </bottom>
    </javadoc>
  </target>

  <!-- Builds the jar files for the project classes -->
  <target name="jar" depends="jar-server"/>

  <!-- builds the server jar file -->
  <target name="jar-server" depends="build-server">
    <mkdir dir="${buildLibDir}"/>
    <jar destfile="${serverJarFile}" basedir="${serverClassDir}"/>
  </target>

</project>
