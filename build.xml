<?xml version="1.0" encoding="UTF-8"?>
<project basedir="." default="release" name="SGS">

    <target name="help">
	<echo message="Please run: $ ant -v -projecthelp" />
    </target>

    <property name="debug" value="true" />
    <property name="optimize" value="true" />
    <property name="deprecated" value="true" />

    <path id="project.classpath">
	<pathelement location="bin" />
	<pathelement location="resources/libs/jrms/classes.jar" />
	<pathelement location="resources/libs/derby/derby.jar" />
	<pathelement location="resources/libs/servlet/javax.servlet.jar" />
	<pathelement location="resources/libs/servlet/commons-logging.jar" />
	<pathelement location="resources/libs/servlet/org.mortbay.jetty.jar" />
    </path>

    <target name="init">
        <mkdir dir="bin"/>
        <mkdir dir="doc"/>
        <mkdir dir="release"/>
    	<mkdir dir="release/apps"/>
    	<mkdir dir="release/apps/trivial_boot"/>
    	<mkdir dir="release/apps/battleboard"/>
    	<mkdir dir="release/apps/chat_test"/>
    	<mkdir dir="release/apps/matchmaker"/>
    	<mkdir dir="release/apps/timer_test"/>
    	<mkdir dir="release/apps/jeffboard"/>
    	<mkdir dir="release/derby"/>
    	<mkdir dir="release/jrms"/>
    	<mkdir dir="doc/doxygen" />
    </target>

    <target name="clean">
	<delete dir="bin" />
	<delete dir="release" />
    </target>

    <target name="realclean" depends="clean">
	<delete dir="doc" />
    </target>

    <!-- Documentation targets -->

    <target name="docs" depends="javadocs,doxygen" />

    <target name="doxygen" depends="doxygen-internal,doxygen-api" />

    <target name="doxygen-api" depends="init">
	<exec executable="doxygen" failonerror="true">
	    <arg value="java-client-api.doxygen" />
	</exec>
	<exec executable="doxygen" failonerror="true">
	    <arg value="java-server-api.doxygen" />
	</exec>
	<exec executable="doxygen" failonerror="true">
	    <arg value="java-stackext-api.doxygen" />
	</exec>
    </target>

    <target name="doxygen-internal" depends="init">
	<exec executable="doxygen" failonerror="true">
	    <arg value="java.doxygen" />
	</exec>
    </target>

    <target name="javadocs" depends="javadocs-internal,javadocs-api" />

    <target name="javadocs-internal" depends="init">
	<javadoc destdir="doc/javadoc/internal" sourcepath="src"
		classpathref="project.classpath" access="private">
	    <package name="com.sun.gi.*" />
	    <tag name="todo" description="To do:" />
	</javadoc>
    </target>

    <target name="javadocs-api" depends="init">
	<javadoc destdir="doc/javadoc/api" sourcepath="src"
		classpathref="project.classpath" access="public">
	    <package name="com.sun.gi.*" />
	    <tag name="todo" description="To do:" />
	</javadoc>
    </target>

    <!-- Compilation targets -->

    <target name="build.server" depends="init">
	<echo message="${ant.project.name}: ${ant.file}" />
	<javac srcdir="src" destdir="bin" source="5" target="5"
		debug="${debug}" optimize="${optimize}"
		deprecation="${deprecated}">
	    <!-- <compilerarg value="-Xlint:unchecked"/> -->
	    <classpath refid="project.classpath" />
	    <exclude name="com/sun/gi/apps/*/*.java" />
	    <exclude name="com/sun/gi/apps/**/server/**" />
	</javac>
    </target>

    <target name="build.chat" depends="init">
	<echo message="${ant.project.name}: ${ant.file}" />
	<javac srcdir="src" destdir="bin" source="5" target="5"
		debug="${debug}" optimize="${optimize}"
		deprecation="${deprecated}">
	    <!-- <compilerarg value="-Xlint:unchecked"/> -->
	    <classpath refid="project.classpath" />
	    <include name="com/sun/gi/apps/chattest/ChatTestBoot.java" />
	</javac>
    </target>

    <target name="build.trivial" depends="init">
	<echo message="${ant.project.name}: ${ant.file}" />
	<javac srcdir="src" destdir="bin" source="5" target="5"
		debug="${debug}" optimize="${optimize}"
		deprecation="${deprecated}">
	    <!-- <compilerarg value="-Xlint:unchecked"/> -->
	    <classpath refid="project.classpath" />
	    <include name="com/sun/gi/apps/trivial/TrivialBoot.java" />
	</javac>
    </target>

    <target name="build.timertest" depends="init">
	<echo message="${ant.project.name}: ${ant.file}" />
	<javac srcdir="src" destdir="bin" source="5" target="5"
		debug="${debug}" optimize="${optimize}"
		deprecation="${deprecated}">
	    <!-- <compilerarg value="-Xlint:unchecked"/> -->
	    <classpath refid="project.classpath" />
	    <include name="com/sun/gi/apps/timertest/**" />
	</javac>
    </target>

    <target name="build.battleboard" depends="init">
	<echo message="${ant.project.name}: ${ant.file}" />
	<javac srcdir="src" destdir="bin" source="5" target="5"
		debug="${debug}" optimize="${optimize}"
		deprecation="${deprecated}">
	    <!-- <compilerarg value="-Xlint:unchecked"/> -->
	    <classpath refid="project.classpath" />
	    <include name="com/sun/gi/apps/battleboard/server/**" />
	</javac>
    </target>

    <target name="build.jeffboard" depends="init">
	<echo message="${ant.project.name}: ${ant.file}" />
	<javac srcdir="src" destdir="bin" source="5" target="5"
		debug="${debug}" optimize="${optimize}"
		deprecation="${deprecated}">
	    <!-- <compilerarg value="-Xlint:unchecked"/> -->
	    <classpath refid="project.classpath" />
	    <include name="com/sun/gi/apps/jeffboard/**" />
	</javac>
    </target>

    <target name="build.matchmaker" depends="init">
	<echo message="${ant.project.name}: ${ant.file}" />
	<javac srcdir="src" destdir="bin" source="5" target="5"
		debug="${debug}" optimize="${optimize}"
		deprecation="${deprecated}">
	    <!-- <compilerarg value="-Xlint:unchecked"/> -->
	    <classpath refid="project.classpath" />
	    <include name="com/sun/gi/apps/mcs/matchmaker/server/**" />
	</javac>
    </target>

    <!-- Runnable Servers -->

    <target name="SGS-clean">
	<java dir="release" classname="com.sun.gi.SGS" failonerror="true" fork="yes">
	    <arg value="-C" />
	    <arg value="-V" />
	    <classpath refid="project.classpath" />
	    <sysproperty key="java.util.logging.config.file"
			 file="logging.properties" />
	</java>
    </target>

    <target name="SGS">
	<java dir="release" classname="com.sun.gi.SGS" failonerror="true" fork="yes">
	    <arg value="-V" />
	    <classpath refid="project.classpath" />
	    <sysproperty key="java.util.logging.config.file"
			 file="logging.properties" />
	</java>
    </target>

    <target name="SGS2">
	<java dir="release" classname="com.sun.gi.SGS" failonerror="true" fork="yes">
	    <arg value="file:Install2.txt" />
	    <classpath refid="project.classpath" />
	    <sysproperty key="java.util.logging.config.file"
			 file="logging.properties" />
	</java>
    </target>

    <!-- Runnable Clients -->

    <target name="ChatTest">
	<java classname="com.sun.gi.apps.commtest.client.ChatTestClient"
		failonerror="true" fork="yes">
	    <classpath refid="project.classpath" />
	    <sysproperty key="java.util.logging.config.file"
			 file="logging.properties" />
	</java>
    </target>

    <target name="ChatTest2">
	<java classname="com.sun.gi.apps.commtest.client.ChatTestClient"
		failonerror="true" fork="yes">
	    <classpath refid="project.classpath" />
	    <sysproperty key="java.util.logging.config.file"
			 file="logging.properties" />
	</java>
    </target>

    <target name="BattleBoard">
	<java classname="com.sun.gi.apps.battleboard.client.BattleBoardClient"
		failonerror="true" fork="true">
	    <classpath refid="project.classpath" />
	    <sysproperty key="java.util.logging.config.file"
			 file="logging.properties" />
	</java>
    </target>

    <target name="MatchMakerClientTest">
	<java classname="com.sun.gi.apps.mcs.matchmaker.client.test.MatchMakerClientTest" failonerror="true" fork="true">
	    <classpath refid="project.classpath" />
	    <sysproperty key="java.util.logging.config.file"
			 file="logging.properties" />
	</java>
    </target>

    <!-- Release Targets -->

    <target name="release" depends="release.server,release.docs,release.apps">
	<zip destfile="ProjectDarkstar.zip" basedir="release" />
    </target>
    
    <target name="release.server" depends="build.server">
	<jar destfile="release/ProjectDarkstar.jar"
	    basedir="bin"
	    excludes="com/sun/gi/apps/**,com/sun/gi/comm/users/client"
	    manifest="resources/ProjectDarkstarManifest.mf" />
	<copy file="resources/startDarkstar.sh" todir="release" />
	<copy file="resources/startDiscovery.sh" todir="release" />
	<chmod file="release/startDarkstar.sh" perm="755" />
	<chmod file="release/startDiscovery.sh" perm="755" />
	<copy file="resources/libs/jrms/classes.jar" todir="release/jrms" />
	<copy file="resources/libs/derby/derby.jar" todir="release/derby" />
	<copy file="resources/Install.txt" todir="release" />
	<copy file="resources/passwd.txt" todir="release" />
    </target>

    <target name="release.docs" depends="docs">
	<copy todir="release/docs" >
	    <fileset dir="doc/doxygen">
		<exclude name="internal/**" />
	    </fileset>
	</copy>
    </target>

    <target name="release.apps"
      depends="release.trivialboot,release.timertest,release.chattest,release.jeffboard">
    </target>

    <target name="release.trivialboot" depends="build.trivial">
	<jar destfile="release/apps/trivial_boot/trivial_boot.jar"
	    basedir="bin" includes="com/sun/gi/apps/trivial/**" />
	<copy file="resources/trivial_boot_deployment.xml"
	    todir="release/apps/trivial_boot" />
    </target>

    <target name="release.chattest" depends="build.chat">
	<jar destfile="release/apps/chat_test/ChatTest.jar"
	    basedir="bin" includes="com/sun/gi/apps/chattest/ChatTestBoot.class" />
	<copy file="resources/chat_test_deployment.xml"
	    todir="release/apps/chat_test" />
    </target>

    <target name="release.battleboard" depends="build.battleboard">
	<jar destfile="release/apps/battleboard/BattleBoard.jar"
	    basedir="bin" includes="com/sun/gi/apps/battleboard/server/**" />
	<copy file="resources/battleboard_deployment.xml"
	    todir="release/apps/battleboard" />
    </target>

    <target name="release.jeffboard" depends="build.jeffboard">
	<jar destfile="release/apps/jeffboard/JeffBoard.jar"
	    basedir="bin" includes="com/sun/gi/apps/jeffboard/**" />
	<copy file="resources/jeffboard_deployment.xml"
	    todir="release/apps/jeffboard" />
    </target>

    <target name="release.matchmaker" depends="build.matchmaker">
	<jar destfile="release/apps/matchmaker/MatchMakerTest.jar"
	    basedir="bin" includes="com/sun/gi/apps/mcs/matchmaker/server/**" />
	<copy file="resources/matchmakertest_deployment.xml"
	    todir="release/apps/matchmaker" />
	<copy file="resources/matchmaker_config.xml"
	    todir="release/apps/matchmaker" />
    </target>

    <target name="release.timertest" depends="build.timertest">
	<jar destfile="release/apps/timer_test/TimerTest.jar"
	    basedir="bin" includes="com/sun/gi/apps/timertest/**" />
	<copy file="resources/timer_test_deployment.xml"
	    todir="release/apps/timer_test" />
    </target>

</project>
