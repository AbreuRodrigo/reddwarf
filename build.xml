<?xml version="1.0" encoding="UTF-8"?>
<project basedir="." default="release.j2se.bin" name="SGS">

    <target name="help">
	<echo message="Please run: $ ant -v -projecthelp" />
    </target>

    <property name="debug" value="true" />
    <property name="optimize" value="true" />
    <property name="deprecated" value="true" />
    <property name="default.lint" value="all,-unchecked" />

    <property name="jrms.version" value="1.1" />
    <property name="derby.version" value="10.1.2.1" />
    <property name="derby.jarfile" value="derby-${derby.version}.jar" />

    <path id="project.classpath">
	<pathelement location="bin" />
	<pathelement location="resources/libs/derby/${derby.jarfile}" />
	<pathelement location="resources/libs/servlet/javax.servlet.jar" />
	<pathelement location="resources/libs/servlet/commons-logging.jar" />
	<pathelement location="resources/libs/servlet/org.mortbay.jetty.jar" />
    </path>

    <path id="build.j2se.server.classpath">
	<pathelement location="resources/libs/derby/${derby.jarfile}" />
    </path>

    <path id="j2se.server.classpath">
	<pathelement location="release/lib/${derby.jarfile}" />
	<pathelement location="release/SunGameServer.jar" />
    </path>

    <path id="build.j2se.client.classpath">
	<pathelement location="release/SGSClient.jar" />
    </path>

    <target name="init">
        <mkdir dir="bin"/>
        <mkdir dir="doc"/>
        <mkdir dir="release"/>
    	<mkdir dir="release/apps"/>
    	<mkdir dir="release/apps/trivial_boot"/>
    	<mkdir dir="release/apps/battleboard"/>
    	<mkdir dir="release/apps/hack"/>
    	<mkdir dir="release/apps/chat_test"/>
    	<mkdir dir="release/apps/swordworld"/>
    	<mkdir dir="release/apps/matchmaker"/>
    	<mkdir dir="release/apps/timer_test"/>
    	<mkdir dir="release/apps/jeffboard"/>
    	<mkdir dir="release/apps/glotest"/>
    	<mkdir dir="release/apps/jnwn"/>
    	<mkdir dir="release/client"/>
    	<mkdir dir="doc/doxygen" />
    </target>

    <target name="clean">
	<delete dir="bin" />
	<delete quiet="true">
	    <fileset dir="release" includes="**/*.jar"/>
	</delete>
    </target>

    <target name="clean.j2meAPI">
	<ant dir="J2MEAPI/J2MEClientAPI" target="clean" /> 
    </target>

    <target name="realclean" depends="clean, clean.j2meAPI">
	<delete dir="doc/doxygen" />
	<delete dir="doc/javadoc" />
	<delete dir="release" />
	<delete file="SunGameServer.zip" />
    </target>

    <!-- Documentation targets -->

    <target name="docs" depends="javadocs" />

    <target name="docs.api" depends="javadocs.api, doxygen.api" />

    <target name="doxygen" depends="doxygen.internal, doxygen.api" />

    <target name="doxygen.api" depends="init">
	<exec executable="doxygen" failonerror="true">
	    <arg value="java-client-api.doxygen" />
	</exec>
	<exec executable="doxygen" failonerror="true">
	    <arg value="java-server-api.doxygen" />
	</exec>
	<exec executable="doxygen" failonerror="true">
	    <arg value="java-stackext-api.doxygen" />
	</exec>
    </target>

    <target name="doxygen.internal" depends="init">
	<exec executable="doxygen" failonerror="true">
	    <arg value="java.doxygen" />
	</exec>
    </target>

    <target name="javadocs" depends="javadocs.api, javadocs.examples" />

    <target name="javadocs.internal" depends="init">
	<javadoc destdir="doc/javadoc/internal" sourcepath="src"
		classpathref="j2se.server.classpath" access="private">
	    <package name="com.sun.gi.*" />
	    <tag name="todo" description="To do:" />
	</javadoc>
    </target>

    <target name="javadocs.api" depends="javadocs.api.client, javadocs.api.server, javadocs.api.stackext"/>

    <target name="javadocs.api.client" depends="init">
	<mkdir  dir="tmp"/>
	<copy todir="tmp">
	    <fileset dir="src">
                <include name="com/sun/gi/comm/users/client/ClientAlreadyConnectedException.java"/>
                <include name="com/sun/gi/comm/users/client/ClientChannel.java"/>
                <include name="com/sun/gi/comm/users/client/ClientChannelListener.java"/>
                <include name="com/sun/gi/comm/users/client/ClientConnectionManager.java"/>
                <include name="com/sun/gi/comm/users/client/ClientConnectionManagerListener.java"/>
                <include name="com/sun/gi/comm/users/client/UserManagerClient.java"/>
                <include name="com/sun/gi/comm/users/client/UserManagerClientListener.java"/>
                <include name="com/sun/gi/comm/users/client/UserManagerPolicy.java"/>
                <include name="com/sun/gi/comm/users/client/impl/ClientConnectionManagerImpl.java"/>
                <include name="com/sun/gi/comm/users/client/impl/DefaultUserManagerPolicy.java"/>
                <include name="com/sun/gi/comm/discovery/DiscoveredUserManager.java"/>
                <include name="com/sun/gi/comm/discovery/DiscoveredGame.java"/>
                <include name="com/sun/gi/comm/discovery/Discoverer.java"/>
                <include name="com/sun/gi/utils/SGSUUID.java"/>
                <include name="com/sun/gi/utils/StatisticalUUID.java"/>
                <include name="com/sun/gi/utils/nio/*.java"/>
                <include name="com/sun/gi/utils/types/*.java"/>
            </fileset>
        </copy>
        <javadoc destdir="doc/javadoc/api/client" sourcepath="tmp" access="public">
	    <package name="com.sun.gi.*" />
        </javadoc>
	<delete dir="tmp"/>
    </target>

    <target name="javadocs.api.server" depends="init">
	<mkdir  dir="tmp"/>
	<copy todir="tmp">
	    <fileset dir="src">
                <include name="com/sun/gi/logic/ExecutionOutsideOfTaskException.java"/>
                <include name="com/sun/gi/logic/GLO.java"/>
                <include name="com/sun/gi/logic/GLOReference.java"/>
                <include name="com/sun/gi/logic/SimBoot.java"/>
                <include name="com/sun/gi/logic/SimUserListener.java"/>
                <include name="com/sun/gi/logic/SimUserDataListener.java"/>
                <include name="com/sun/gi/logic/SimTimerListener.java"/>
                <include name="com/sun/gi/logic/SimTask.java"/>
                <include name="com/sun/gi/logic/SGSError.java"/>
                <include name="com/sun/gi/framework/rawsocket/SimRawSocketListener.java"/>
                <include name="com/sun/gi/comm/routing/UserID.java"/>
                <include name="com/sun/gi/comm/routing/ChannelID.java"/>
                <include name="com/sun/gi/gloutils/**/*.java"/>
                <include name="com/sun/gi/apps/chattest.java"/>
                <include name="com/sun/gi/utils/SGSUUID.java"/>
                <include name="com/sun/gi/utils/StatisticalUUID.java"/>
                <include name="com/sun/gi/utils/nio/*.java"/>
                <include name="com/sun/gi/utils/types/*.java"/>
            </fileset>
        </copy>
        <javadoc destdir="doc/javadoc/api/server" sourcepath="tmp" access="public">
	    <package name="com.sun.gi.*" />
        </javadoc>
	<delete dir="tmp"/>
    </target>

    <target name="javadocs.api.stackext" depends="init">
	<mkdir  dir="tmp"/>
	<copy todir="tmp">
	    <fileset dir="src">
                <include name="com/sun/gi/comm/users/protocol/TransportProtocol.java"/>
                <include name="com/sun/gi/comm/users/protocol/TransportProtocolClient.java"/>
                <include name="com/sun/gi/comm/users/protocol/TransportProtocolServer.java"/>
                <include name="com/sun/gi/comm/users/protocol/TransportProtocolTransmitter.java"/>
                <include name="com/sun/gi/comm/users/protocol/impl/BinaryPktProtocol.java"/>
                <include name="com/sun/gi/comm/users/protocol/impl/ValidationDataProtocol.java"/>
                <include name="com/sun/gi/comm/users/client/impl/TCPIPUserManagerClient.java"/>
                <include name="com/sun/gi/comm/users/client/UserManagerClient.java"/>
                <include name="com/sun/gi/comm/users/client/UserManagerClientListener.java"/>
                <include name="com/sun/gi/comm/users/client/UserManagerPolicy.java"/>
                <include name="com/sun/gi/comm/users/client/impl/DefaultUserManagerPolicy.java"/>
                <include name="com/sun/gi/comm/users/server/impl/TCPIPUserManager.java"/>
                <include name="com/sun/gi/comm/users/server/impl/SGSUserImpl.java"/>
                <include name="com/sun/gi/comm/users/server/UserManager.java"/>
                <include name="com/sun/gi/comm/users/server/SGSUser.java"/>
                <include name="com/sun/gi/comm/discovery/DiscoveredUserManager.java"/>
                <include name="com/sun/gi/comm/discovery/DiscoveredGame.java"/>
                <include name="com/sun/gi/comm/discovery/Discoverer.java"/>
                <include name="com/sun/gi/comm/routing/Router.java"/>
                <include name="com/sun/gi/comm/routing/RouterListener.java"/>
                <include name="com/sun/gi/comm/routing/UserID.java"/>
                <include name="com/sun/gi/comm/routing/ChannelID.java"/>
                <include name="com/sun/gi/comm/routing/SGSChannel.java"/>
                <include name="com/sun/gi/comm/users/validation/UserValidatorFactory.java"/>
                <include name="com/sun/gi/comm/users/validation/UserValidator.java"/>
                <include name="com/sun/gi/utils/SGSUUID.java"/>
                <include name="com/sun/gi/utils/StatisticalUUID.java"/>
                <include name="com/sun/gi/utils/nio/*.java"/>
                <include name="com/sun/gi/utils/types/*.java"/>
            </fileset>
        </copy>
        <javadoc destdir="doc/javadoc/api/stack-extension" sourcepath="tmp" access="public">
	    <package name="com.sun.gi.*" />
        </javadoc>
	<delete dir="tmp"/>
    </target>

    <target name="javadocs.examples" depends="javadocs.example.battleboard, javadocs.example.chattest, javadocs.example.matchmaker, javadocs.example.hack"/>

    <target name="javadocs.example.battleboard" depends="init">
	<javadoc destdir="doc/javadoc/battleboard" sourcepath="src"
		classpathref="project.classpath" access="public">
	    <package name="com.sun.gi.apps.battleboard.*" />
	</javadoc>
    </target>

    <target name="javadocs.example.chattest" depends="init">
	<javadoc destdir="doc/javadoc/chattest" sourcepath="src"
		classpathref="project.classpath" access="public">
	    <package name="com.sun.gi.apps.chattest.*" />
	</javadoc>
    </target>

    <target name="javadocs.example.matchmaker" depends="init">
	<javadoc destdir="doc/javadoc/matchmaker" sourcepath="src"
		classpathref="project.classpath" access="public">
	    <package name="com.sun.gi.apps.mcs.matchmaker.*" />
	</javadoc>
    </target>

    <target name="javadocs.example.hack" depends="init">
	<javadoc destdir="doc/javadoc/hack" sourcepath="src"
		classpathref="project.classpath" access="public">
	    <package name="com.sun.gi.apps.hack.*" />
	</javadoc>
    </target>

    <!-- Compilation targets -->

    <target name="build.server" depends="init">
	<javac srcdir="src" destdir="bin" source="5" target="5"
		debug="${debug}" optimize="${optimize}"
		deprecation="${deprecated}">
	    <classpath refid="build.j2se.server.classpath" />
	    <compilerarg value="-Xlint:${default.lint}"/>
	    <exclude name="com/sun/gi/apps/**" />
	    <exclude name="com/sun/gi/client/**" />
	    <exclude name="com/sun/gi/objectstore/test/**" />
	    <exclude name="com/sun/gi/objectstore/hadbtest/**" />
	    <exclude name="com/sun/gi/objectstore/tso/dataspace/monitor/**" />
	    <exclude name="com/sun/gi/objectstore/tso/dataspace/HadbDataSpace.java" />
	    <exclude name="com/sun/gi/utils/http/**" />
	    <exclude name="com/sun/gi/**/JME*.java" />
	</javac>
    </target>


    <target name="build.j2seAPI" depends="init">
	<javac srcdir="src" sourcepath="" destdir="bin" source="5" target="5"
		debug="${debug}" optimize="${optimize}"
		deprecation="${deprecated}">
	    <compilerarg value="-Xlint:${default.lint}"/>
	    <include name="com/sun/gi/comm/users/client/**" />
	    <include name="com/sun/gi/comm/users/protocol/**" />
	    <include name="com/sun/gi/validation/**" />
	    <include name="com/sun/gi/comm/discovery/**" />
	    <include name="com/sun/gi/utils/StatisticalUUID.java" />
	    <include name="com/sun/gi/utils/SGSUUID.java" />
	    <include name="com/sun/gi/utils/nio/**" />
	    <include name="com/sun/gi/utils/types/**" />
	</javac>
    </target>

    <target name="build.j2meAPI" depends="init">
        <ant dir="J2MEAPI/J2MEClientAPI" target="jar"/>
    </target>

    <target name="build.chat" depends="init">
	<javac srcdir="src" destdir="bin" source="5" target="5"
		debug="${debug}" optimize="${optimize}"
		deprecation="${deprecated}">
	    <compilerarg value="-Xlint:all"/>
	    <classpath refid="build.j2se.client.classpath" />
	    <include name="com/sun/gi/apps/chattest/ChatTestBoot.java" />
	</javac>
    </target>

    <target name="build.swordworld" depends="init">
	<javac srcdir="src" destdir="bin" source="5" target="5"
		debug="${debug}" optimize="${optimize}"
		deprecation="${deprecated}">
	    <compilerarg value="-Xlint:all"/>
	    <classpath refid="build.j2se.client.classpath" />
	    <include name="com/sun/gi/apps/swordworld/SwordWorldBoot.java" />
	</javac>
    </target>

    <target name="build.trivial" depends="init">
	<javac srcdir="src" destdir="bin" source="5" target="5"
		debug="${debug}" optimize="${optimize}"
		deprecation="${deprecated}">
	    <compilerarg value="-Xlint:all"/>
	    <classpath refid="build.j2se.client.classpath" />
	    <include name="com/sun/gi/apps/trivial/TrivialBoot.java" />
	</javac>
    </target>

    <target name="build.timertest" depends="init">
	<javac srcdir="src" destdir="bin" source="5" target="5"
		debug="${debug}" optimize="${optimize}"
		deprecation="${deprecated}">
	    <compilerarg value="-Xlint:all"/>
	    <classpath refid="build.j2se.client.classpath" />
	    <include name="com/sun/gi/apps/timertest/**" />
	</javac>
    </target>

    <target name="build.battleboard" depends="init">
	<javac srcdir="src" destdir="bin" source="5" target="5"
		debug="${debug}" optimize="${optimize}"
		deprecation="${deprecated}">
	    <compilerarg value="-Xlint:all"/>
	    <classpath refid="build.j2se.client.classpath" />
	    <include name="com/sun/gi/apps/battleboard/server/**" />
	</javac>
    </target>

    <target name="build.jeffboard" depends="init">
	<javac srcdir="src" destdir="bin" source="5" target="5"
		debug="${debug}" optimize="${optimize}"
		deprecation="${deprecated}">
	    <compilerarg value="-Xlint:all"/>
	    <classpath refid="build.j2se.client.classpath" />
	    <include name="com/sun/gi/apps/jeffboard/**" />
	</javac>
    </target>

    <target name="build.matchmaker" depends="init">
	<javac srcdir="src" destdir="bin" source="5" target="5"
		debug="${debug}" optimize="${optimize}"
		deprecation="${deprecated}">
	    <compilerarg value="-Xlint:${default.lint}"/>
	    <classpath refid="build.j2se.client.classpath" />
	    <include name="com/sun/gi/apps/mcs/matchmaker/server/**" />
	    <include name="com/sun/gi/apps/mcs/matchmaker/common/**" />
	</javac>
    </target>

    <target name="build.glotest" depends="init">
	<javac srcdir="src" destdir="bin" source="5" target="5"
		debug="${debug}" optimize="${optimize}"
		deprecation="${deprecated}">
	    <compilerarg value="-Xlint:all"/>
	    <classpath refid="build.j2se.client.classpath" />
	    <include name="com/sun/gi/apps/glotest/*.java" />
	</javac>
    </target>

    <target name="build.jnwn" depends="init">
	<javac srcdir="src" destdir="bin" source="5" target="5"
		debug="${debug}" optimize="${optimize}"
		deprecation="${deprecated}">
	    <compilerarg value="-Xlint:all"/>
	    <classpath refid="build.j2se.client.classpath" />
	    <classpath location="NWNSupport.jar"/>
	    <classpath location="/usr/share/java/java3d/j3dutils.jar"/>
	    <classpath location="/usr/share/java/java3d/vecmath.jar"/>
	    <include name="com/sun/gi/apps/jnwn/**"/>
            <!--
	    <exclude name="com/sun/gi/apps/jnwn/AreaFactory.java"/>
	    <exclude name="com/sun/gi/apps/jnwn/WalkMeshCheatDetector.java"/>
            -->
	</javac>
    </target>

    <target name="build.hack" depends="init, release.server">
	<javac srcdir="src" destdir="bin" source="5" target="5"
		debug="${debug}" optimize="${optimize}"
		deprecation="${deprecated}">
	    <compilerarg value="-Xlint:all,-serial"/>
	    <classpath refid="j2se.server.classpath" />
	    <include name="com/sun/gi/apps/hack/server/**/*.java" />
	    <include name="com/sun/gi/apps/hack/share/**/*.java" />
	</javac>
    </target>

    <target name="build.clients" depends="build.client.matchmaker, build.client.other"/>

    <target name="build.client.matchmaker" depends="release.j2seAPI">
	<javac srcdir="src" destdir="bin" source="5" target="5"
		debug="${debug}" optimize="${optimize}"
		deprecation="${deprecated}">
	    <compilerarg value="-Xlint:all,-unchecked,-serial"/>
	    <classpath refid="build.j2se.client.classpath" />
	    <include name="com/sun/gi/apps/mcs/matchmaker/**" />
	    <exclude name="com/sun/gi/apps/mcs/matchmaker/server/**" />
	</javac>
    </target>

    <target name="build.client.other" depends="release.j2seAPI">
	<javac srcdir="src" destdir="bin" source="5" target="5"
		debug="${debug}" optimize="${optimize}"
		deprecation="${deprecated}">
	    <compilerarg value="-Xlint:all"/>
	    <classpath refid="build.j2se.client.classpath" />
	    <include name="com/sun/gi/client/**" />
	    <include name="com/sun/gi/apps/**" />
	    <exclude name="com/sun/gi/apps/*/*.java" />
	    <exclude name="com/sun/gi/apps/**/server/**" />
	    <exclude name="com/sun/gi/apps/hack/**" />
	    <exclude name="com/sun/gi/apps/mcs/**" />
	</javac>
    </target>

    <target name="build.client.hack" depends="init, release.j2seAPI">
	<javac srcdir="src" destdir="bin" source="5" target="5"
		debug="${debug}" optimize="${optimize}"
		deprecation="${deprecated}">
	    <compilerarg value="-Xlint:all,-serial"/>
	    <classpath refid="build.j2se.client.classpath" />
	    <include name="com/sun/gi/apps/hack/client/**/*.java" />
	    <include name="com/sun/gi/apps/hack/share/**/*.java" />
	</javac>
    </target>

    <!-- Runnable Servers -->

    <target name="SGS-clean">
	<java dir="release" jar="release/SunGameServer.jar" failonerror="true" fork="yes">
	    <arg value="-C"/>
	    <arg value="-V"/>
	    <classpath refid="j2se.server.classpath"/>
	    <sysproperty key="java.util.logging.config.file"
			 file="logging.properties"/>
	</java>
    </target>

    <target name="SGS-jnwn-clean">
	<java dir="release" jar="release/SunGameServer.jar" failonerror="true" fork="yes">
	    <arg value="-C"/>
	    <arg value="-V"/>
	    <arg value="-I"/>
	    <arg value="file:JNWN-server.txt" />
	    <classpath refid="j2se.server.classpath"/>
	    <classpath location="NWNSupport.jar"/>
	    <classpath location="genesisfx.jar"/>
	    <classpath location="/usr/share/java/java3d/j3dcore.jar"/>
	    <classpath location="/usr/share/java/java3d/j3dutils.jar"/>
	    <classpath location="/usr/share/java/java3d/vecmath.jar"/>
	    <sysproperty key="jnwn.data.dir" path="/u01/nwn"/>
	    <sysproperty key="java.util.logging.config.file"
			 file="logging.properties"/>
	</java>
    </target>

    <target name="SGS">
	<java dir="release" jar="release/SunGameServer.jar" failonerror="true" fork="yes">
	    <arg value="-V" />
	    <classpath refid="j2se.server.classpath" />
	    <sysproperty key="java.util.logging.config.file"
			 file="logging.properties" />
	</java>
    </target>

    <target name="SGS2">
	<java dir="release" jar="release/SunGameServer.jar" failonerror="true" fork="yes">
	    <arg value="-I"/>
	    <arg value="file:SGS-apps-2.conf" />
	    <classpath refid="j2se.server.classpath" />
	    <sysproperty key="java.util.logging.config.file"
			 file="logging.properties" />
	</java>
    </target>

    <!-- Runnable Clients -->

    <target name="ChatTest">
	<java classname="com.sun.gi.apps.commtest.client.ChatTestClient"
		failonerror="true" fork="yes">
	    <classpath refid="build.j2se.client.classpath" />
	    <sysproperty key="java.util.logging.config.file"
			 file="logging.properties" />
	</java>
    </target>

    <target name="ChatTest2">
	<java classname="com.sun.gi.apps.commtest.client.ChatTestClient"
		failonerror="true" fork="yes">
	    <classpath refid="build.j2se.client.classpath" />
	    <sysproperty key="java.util.logging.config.file"
			 file="logging.properties" />
	</java>
    </target>

    <target name="BattleBoard">
	<echo message="WARNING:  Ant on Linux won't let us input on stdin; run manually"/>
	<java jar="release/client/BattleBoardClient.jar" failonerror="true" fork="true">
	    <sysproperty key="java.util.logging.config.file"
			 file="logging.properties" />
	</java>
    </target>

    <target name="Hack">
	<java jar="release/client/HackClient.jar" failonerror="true" fork="true">
	    <classpath refid="build.j2se.client.classpath" />
	    <sysproperty key="java.util.logging.config.file"
			 file="logging.properties" />
	</java>
    </target>

    <target name="MatchMakerClientTestUI">
	<java classname="com.sun.gi.apps.mcs.matchmaker.client.test.MatchMakerClientTestUI" failonerror="true" fork="true">
	    <classpath refid="build.j2se.client.classpath" />
	    <sysproperty key="java.util.logging.config.file"
			 file="logging.properties" />
	</java>
    </target>

    <target name="DIRC">
	<java classname="com.sun.gi.client.dirc.DIRC"
		failonerror="true" fork="true">
	    <classpath refid="build.j2se.client.classpath" />
	    <sysproperty key="java.util.logging.config.file"
			 file="logging.properties" />
	</java>
    </target>

    <!-- Release Targets -->

    <!--<target name="release" depends="release.j2se, release.j2me">-->
    <target name="release" depends="release.j2se">
	<zip destfile="SunGameServer.zip">
	    <fileset dir="release">
		<exclude name="persistant_store/**"/>
	    </fileset>
	</zip>
    </target>

    <!-- J2SE release targets -->

    <target name="release.j2se" depends="release.j2se.bin, release.docs, release.examples"/>

    <target name="release.j2se.bin" depends="release.server, release.j2seAPI, release.apps, release.clients"/>

    <target name="release.server" depends="build.server">
	<jar destfile="release/SunGameServer.jar">
	    <manifest>
		<attribute name="Class-Path"
			   value="lib/${derby.jarfile}"/>
		<attribute name="Main-Class"
			   value="com.sun.gi.SGS"/>
	    </manifest>
	    <fileset dir="bin">
		<exclude name="com/sun/gi/apps/**"/>
		<exclude name="com/sun/gi/client/**"/>
		<exclude name="com/sun/gi/comm/users/client/**"/>
	    </fileset>
	</jar>
	<copy file="resources/startSGS.sh" todir="release" />
	<copy file="resources/startChatClient.sh" todir="release" />
	<chmod file="release/startSGS.sh" perm="755" />
	<chmod file="release/startChatClient.sh" perm="755" />
	<copy file="resources/libs/derby/${derby.jarfile}" todir="release/lib" />
	<copy file="resources/SGS-apps.conf" todir="release" />
	<copy file="resources/passwd.txt" todir="release" />
	<copy file="resources/FakeDiscovery.xml" todir="release" />
    </target>

    <target name="release.j2seAPI" depends="build.j2seAPI">
	<jar destfile="release/SGSClient.jar">
	    <fileset dir="bin">
		<include name="com/sun/gi/comm/users/client/**"/>
		<include name="com/sun/gi/comm/users/protocol/**"/>
		<include name="com/sun/gi/validation/**"/>
		<include name="com/sun/gi/comm/discovery/**"/>
                <include name="com/sun/gi/utils/StatisticalUUID.class" />
                <include name="com/sun/gi/utils/SGSUUID.class" />
		<include name="com/sun/gi/utils/nio/**"/>
		<include name="com/sun/gi/utils/types/**"/>
	    </fileset>
	</jar>
    </target>
	
    <target name="release.docs" depends="docs">
	<copy todir="release/docs" >
	    <fileset dir="doc/doxygen">
		<exclude name="internal/**" />
	    </fileset>
	</copy>
    </target>

    <target name="release.clients" depends="release.client.battleboard, release.client.hack, release.client.chattest, release.client.matchmaker, release.client.other, release.client.swordworld"/>

    <target name="release.client.other" depends="build.clients, release.j2seAPI"/>

    <target name="release.client.battleboard" depends="build.clients, release.j2seAPI">
	<jar destfile="release/client/BattleBoardClient.jar">
	    <manifest>
		<attribute name="Class-Path"
			   value="SGSClient.jar"/>
		<attribute name="Main-Class"
			   value="com.sun.gi.apps.battleboard.client.BattleBoardClient"/>
	    </manifest>
	    <fileset dir="bin">
		<include name="com/sun/gi/apps/battleboard/*.class"/>
		<include name="com/sun/gi/apps/battleboard/client/**"/>
	    </fileset>
	    <fileset dir="src">
		<include name="com/sun/gi/apps/battleboard/client/swing/imgs/**"/>
	    </fileset>
	</jar>
    </target>

    <target name="release.client.chattest" depends="build.clients, release.j2seAPI">
	<jar destfile="release/client/ChatTestClient.jar">
	    <manifest>
		<attribute name="Class-Path"
			   value="SGSClient.jar"/>
		<attribute name="Main-Class"
			   value="com.sun.gi.apps.chattest.client.ChatTestClient"/>
	    </manifest>
	    <fileset dir="bin">
		<include name="com/sun/gi/apps/chattest/client/**/*.class"/>
	    </fileset>
	</jar>
    </target>
    
    <target name="release.client.swordworld" depends="build.clients, release.j2seAPI">
	<jar destfile="release/client/SwordWorldClient.jar">
	    <manifest>
		<attribute name="Class-Path"
			   value="SGSClient.jar"/>
		<attribute name="Main-Class"
			   value="com.sun.gi.apps.swordworld.client.SwordWorldClient"/>
	    </manifest>
	    <fileset dir="bin">
		<include name="com/sun/gi/apps/swordworld/client/**/*.class"/>
	    </fileset>
	</jar>
    </target>

    <target name="release.client.matchmaker" depends="build.client.matchmaker, release.j2seAPI">
	<jar destfile="release/client/MatchmakerTestClient.jar">
	    <manifest>
		<attribute name="Class-Path"
			   value="SGSClient.jar"/>
		<attribute name="Main-Class"
			   value="com.sun.gi.apps.mcs.matchmaker.client.test.MatchMakerClientTestUI"/>
	    </manifest>
	    <fileset dir="bin">
		<include name="com/sun/gi/apps/mcs/matchmaker/client/**/*.class"/>
		<include name="com/sun/gi/apps/mcs/matchmaker/common/**/*.class"/>
	    </fileset>
	</jar>
    </target>

    <target name="release.client.hack" depends="build.client.hack, release.j2seAPI">
	<jar destfile="release/client/HackClient.jar">
	    <manifest>
		<attribute name="Class-Path"
			   value="SGSClient.jar"/>
		<attribute name="Main-Class"
			   value="com.sun.gi.apps.hack.client.Client"/>
	    </manifest>
	    <fileset dir="bin">
		<include name="com/sun/gi/apps/hack/client/**/*.class"/>
		<include name="com/sun/gi/apps/hack/share/**/*.class"/>
		<include name="com/sun/gi/comm/routing/**/*ID.class"/>
	    </fileset>
	    <fileset dir="resources/hack">
		<include name="data/**"/>
	    </fileset>
	</jar>
    </target>

    <target name="release.apps"
	depends="release.trivialboot, release.timertest, release.chattest, release.jeffboard, release.battleboard, release.hack, release.glotest, release.matchmaker,release.swordworld">
    </target>

    <target name="release.trivialboot" depends="build.trivial">
	<jar destfile="release/apps/trivial_boot/trivial_boot.jar"
	    basedir="bin" includes="com/sun/gi/apps/trivial/**" />
	<copy file="resources/trivial_boot_deployment.xml"
	    todir="release/apps/trivial_boot" />
    </target>

    <target name="release.chattest" depends="build.chat">
	<jar destfile="release/apps/chat_test/ChatTest.jar"
	    basedir="bin" includes="com/sun/gi/apps/chattest/ChatTestBoot.class" />
	<copy file="resources/chat_test_deployment.xml"
	    todir="release/apps/chat_test" />
    </target>

    <target name="release.swordworld" depends="build.swordworld">
	<jar destfile="release/apps/swordworld/SwordWorld.jar"
	    basedir="bin" includes="com/sun/gi/apps/swordworld/**" />
	<copy file="resources/swordworld_deployment.xml"
	    todir="release/apps/swordworld" />
    </target>

    <target name="release.battleboard" depends="build.battleboard">
	<jar destfile="release/apps/battleboard/BattleBoard.jar">
	    <fileset dir="bin">
		<include name="com/sun/gi/apps/battleboard/*.class"/>
		<include name="com/sun/gi/apps/battleboard/server/**"/>
	    </fileset>
	</jar>
	<copy file="resources/battleboard_deployment.xml"
	    todir="release/apps/battleboard" />
    </target>

    <target name="release.hack" depends="build.hack">
	<jar destfile="release/apps/hack/Hack.jar">
	    <fileset dir="bin">
		<include name="com/sun/gi/apps/hack/server/**/*.class"/>
		<include name="com/sun/gi/apps/hack/share/**/*.class"/>
	    </fileset>
	</jar>
	<copy file="resources/hack/deploy.xml"
	    todir="release/apps/hack" />
	<copy todir="release/apps/hack">
	    <fileset dir="resources/hack" includes="data/**"/>
	</copy>
    </target>

    <target name="release.glotest" depends="build.glotest">
	<jar destfile="release/apps/glotest/GLOTest.jar"
	    basedir="bin" includes="com/sun/gi/apps/glotest/*.class" />
	<copy file="resources/test_channel_race.xml"
	    todir="release/apps/glotest" />
    </target>

    <target name="release.jeffboard" depends="build.jeffboard">
	<jar destfile="release/apps/jeffboard/JeffBoard.jar"
	    basedir="bin" includes="com/sun/gi/apps/jeffboard/**" />
	<copy file="resources/jeffboard_deployment.xml"
	    todir="release/apps/jeffboard" />
    </target>

    <target name="release.matchmaker" depends="build.matchmaker">
	<jar destfile="release/apps/matchmaker/MatchMaker.jar">
	    <fileset dir="bin">
		<include name="com/sun/gi/apps/mcs/matchmaker/server/**/*.class"/>
		<include name="com/sun/gi/apps/mcs/matchmaker/common/**/*.class"/>
	    </fileset>
	</jar>
	<copy file="resources/matchmaker_deployment.xml"
	    todir="release/apps/matchmaker" />
	<copy file="resources/matchmaker_config.xml"
	    todir="release/apps/matchmaker" />
    </target>
	
    <target name="release.timertest" depends="build.timertest">
	<jar destfile="release/apps/timer_test/TimerTest.jar"
	    basedir="bin" includes="com/sun/gi/apps/timertest/**" />
	<copy file="resources/timer_test_deployment.xml"
	    todir="release/apps/timer_test" />
    </target>

    <target name="release.jnwn" depends="build.jnwn">
	<jar destfile="release/apps/jnwn/JNWN.jar"
	    basedir="bin" includes="com/sun/gi/apps/jnwn/**" />
	<copy file="resources/jnwn/deploy.xml"
	    todir="release/apps/jnwn" />
    </target>

    <!-- J2SE zip targets -->

    <target name="release.examples" >
	<zip destfile="release/Examples.zip" basedir="src"
	    includes="com/sun/gi/apps/chattest/**"/>
    </target>

    <target name="zip.matchmaker" depends="release.matchmaker">
	<zip destfile="release/apps/matchmaker/MatchMaker.zip" basedir="release" 
		includes="apps/matchmaker/*" excludes="apps/*">
	</zip>
    </target>
	
    <target name="zip.matchmaker.client.source">
	<zip destfile="release/J2SE_MM_client_src.zip" basedir="src"
		includes="com/sun/gi/apps/mcs/matchmaker/client/**,
			com/sun/gi/apps/mcs/matchmaker/common/*" />
    </target>

    <!-- J2ME release targets -->

    <target name="release.j2me" depends="release.j2meAPI"/>

    <target name="release.j2meAPI" depends="build.j2meAPI">
	<copy todir="release" >
	    <fileset dir="J2MEAPI/J2MEClientAPI/dist" />
	</copy>	
    </target>

</project>
